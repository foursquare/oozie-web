<% import org.apache.oozie.client.WorkflowJob %>
<% import com.foursquare.oozie.dashboard.Implicits._ %>
<%@ var workflow: WorkflowJob %>
<%@ var definition: String %>
<%@ val props: List[String] %>
<h2>${workflow.getAppName}</h2>
<div id="tabs" class="ui-tabs ui-widget ui-widget-content ui-corner-all">
  <ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
    <li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#tabs-1">Info</a></li>
    <li class="ui-state-default ui-corner-top"><a href="#tabs-2">Job Definition</a></li>
    <li class="ui-state-default ui-corner-top"><a href="#tabs-3">Graph</a></li>
  </ul>

<div id="tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom">

<div class="row">
  <div class="span6">
    <h3>Info</h3>
    <table class="table table-striped table-bordered">
      <tbody>
        <tr>
          <td>Id</td>
          <td>${workflow.getId}</td>
        </tr>
        <tr>
          <td>Status</td>
          <td class="${workflow.getStatus.toString}">${workflow.getStatus.toString}</td>
        </tr>
        <tr>
          <td>Author</td>
          <td>${workflow.getUser}</td>
        </tr>
        <tr>
          <td>Started At</td>
          <td>${workflow.getCreatedTime.pp}</td>
        </tr>
        <tr>
          <td title="usually useless">Workflow Log</td>
          <% val linkText = if(workflow.getStatus.toString == "FAILED") "there be dragons" else "all looks rosey" %>
          <td><a href="/workflows/${workflow.getId}/log">${linkText}</a></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<h3>Actions</h3>
<table class="table table-striped table-bordered">
  <thead>
    <tr>
    <th>Name</th>
    <th>Type</th>
    <th>Start Time</th>
    <th>Status</th>
    <th>External</th>
  </tr>
  </thead>
  <tbody>
    #for(action <- workflow.getActions)
      <tr>
        <td>${action.getName} <span class="mini">${action.getId}</span></td>
        <td>${action.getType.toString}</td>
        <td>${action.getStartTime.pp}</td>
        <td class="${action.getStatus.toString}">${action.getStatus.toString} (=> ${action.getTransition})</td>
        <td><a href="${action.getUrl}">${action.getExternalId}</a></td>
      </tr>
    #end
  </tbody>
</table>
</div> <!-- tab-->


<div id="tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom">
<h3>Job Definition</h3>
<div id="definition">
  <pre class="brush: xml">
${definition}
  </pre>
</div>

<h3>Configuration</h3>
<div id="config">
  <pre class="brush: xml">
${workflow.getConf}
  </pre>
</div>
<h3>User Props (beta)</h3>
<div id="user-props">
  <p>If you want to re-run, I think these are the user-props:</p>
  #for(prop <- props)
    ${prop}
    <br />
  #end
</div>
</div> <!-- tab-->

<div id="tabs-3" class="ui-tabs-panel ui-widget-content ui-corner-bottom">
<h3>Graph</h3>
<div id="graph">
        
</div>
</div> <!-- tab-->

</div> <!-- tab outer-->

<script type="text/javascript">

      $(document).ready(loadData());

</script >

<script type="text/javascript">
  $(document).ready(function(){
    SyntaxHighlighter.all();
  });
</script>

<script type="text/javascript">
      $(function() {
          $( "#tabs" ).tabs();
            });
</script>
